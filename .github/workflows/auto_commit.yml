name: Auto Commit New TikTok Recordings

on:
  push:
    branches:
      - main
  schedule:
    - cron: '*/5 * * * *' # every 5 minutes

jobs:
  auto-commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Git
      run: |
        git config --global user.name "TikTok Recorder Bot"
        git config --global user.email "noreply@example.com"

    - name: Detect new recordings
      id: detect
      run: |
        NEW_FILES=$(git ls-files --others --exclude-standard recordings/)
        echo "new_files=$NEW_FILES" >> $GITHUB_OUTPUT

    - name: Commit and push new recordings
      if: steps.detect.outputs.new_files != ''
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "New recordings detected: ${{ steps.detect.outputs.new_files }}"
        git add ${{ steps.detect.outputs.new_files }}
        git commit -m "Auto-commit new TikTok recordings $(date '+%Y-%m-%d %H:%M:%S')"
        git push origin main

    - name: No new recordings
      if: steps.detect.outputs.new_files == ''
      run: echo "No new recordings to commit."
